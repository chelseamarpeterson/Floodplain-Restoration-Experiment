for (i in 1:n.plt) {
for (j in 1:n.quad) {
# get data for given year, treatment, plot, and quadrat
quad.id = which((bm.all$year == y &bm.all$trt == t) & (bm.all$num == as.character(i) & bm.all$quad == paste("Q", j, sep="")))
quad.df = bm.all[quad.id,]
# get HL and FWD id
hl.id = which(quad.df$spp == "Herbaceous litter")
fwd.id = which(quad.df$spp == "Fine woody debris")
pa.id = which(quad.df$spp == "Phalaris arundinacea")
hj.id = which(quad.df$spp == "Humulus japonicus")
# sum mass for each category
df.quad.sum[k, "Herbaceous biomass"] = sum(quad.df[-c(hl.id,fwd.id),"mass.g.m2"])
df.quad.sum[k, "Herbaceous litter"] =  sum(quad.df[hl.id,"mass.g.m2"])
df.quad.sum[k, "Fine woody debris"] = sum(quad.df[fwd.id,"mass.g.m2"])
if (length(pa.id) > 0) {
df.quad.sum[k, "Phalaris arundinacea"] = sum(quad.df[pa.id,"mass.g.m2"])
} else {
df.quad.sum[k, "Phalaris arundinacea"] = 0
}
# fill in identification columns
df.quad.sum[k, c("year","trt","trt.full","num","quad")] = c(y, t, trt.names[l], i, j)
# increment counter
k = k + 1
}
}
}
}
View(df.quad.sum)
n.yr = 2; n.trt = 6; n.plt = 3; n.quad = 5
df.quad.sum = data.frame(matrix(nrow = n.yr*n.trt*n.plt*n.quad, ncol=11))
colnames(df.quad.sum) = c("year","trt","trt.full","num","quad","Herbaceous biomass","Herbaceous litter","Fine woody debris","Mixed species","Phalaris arundinacea","Humulus japonicus")
k = 1
for (y in c(2022, 2023)) {
for (l in 1:n.trt) {
t = trts[l]
for (i in 1:n.plt) {
for (j in 1:n.quad) {
# get data for given year, treatment, plot, and quadrat
quad.id = which((bm.all$year == y &bm.all$trt == t) & (bm.all$num == as.character(i) & bm.all$quad == paste("Q", j, sep="")))
quad.df = bm.all[quad.id,]
# get HL and FWD id
hl.id = which(quad.df$spp == "Herbaceous litter")
fwd.id = which(quad.df$spp == "Fine woody debris")
pa.id = which(quad.df$spp == "Phalaris arundinacea")
hj.id = which(quad.df$spp == "Humulus japonicus")
# sum mass for each category
df.quad.sum[k, "Herbaceous biomass"] = sum(quad.df[-c(hl.id,fwd.id),"mass.g.m2"])
df.quad.sum[k, "Herbaceous litter"] =  sum(quad.df[hl.id,"mass.g.m2"])
df.quad.sum[k, "Fine woody debris"] = sum(quad.df[fwd.id,"mass.g.m2"])
if (length(pa.id) > 0) {
df.quad.sum[k, "Phalaris arundinacea"] = sum(quad.df[pa.id,"mass.g.m2"])
} else {
df.quad.sum[k, "Phalaris arundinacea"] = 0
}
if (length(hj.id) > 0) {
df.quad.sum[k, "Humulus japonicus"] = sum(quad.df[hj.id,"mass.g.m2"])
} else {
df.quad.sum[k, "Humulus japonicus"] = 0
}
# fill in identification columns
df.quad.sum[k, c("year","trt","trt.full","num","quad")] = c(y, t, trt.names[l], i, j)
# increment counter
k = k + 1
}
}
}
}
View(df.quad.sum)
n.yr = 2; n.trt = 6; n.plt = 3; n.quad = 5
df.quad.sum = data.frame(matrix(nrow = n.yr*n.trt*n.plt*n.quad, ncol=11))
colnames(df.quad.sum) = c("year","trt","trt.full","num","quad","Herbaceous biomass","Herbaceous litter","Fine woody debris","Mixed species","Phalaris arundinacea","Humulus japonicus")
k = 1
for (y in c(2022, 2023)) {
for (l in 1:n.trt) {
t = trts[l]
for (i in 1:n.plt) {
for (j in 1:n.quad) {
# get data for given year, treatment, plot, and quadrat
quad.id = which((bm.all$year == y &bm.all$trt == t) & (bm.all$num == as.character(i) & bm.all$quad == paste("Q", j, sep="")))
quad.df = bm.all[quad.id,]
# get HL and FWD id
hl.id = which(quad.df$spp == "Herbaceous litter")
fwd.id = which(quad.df$spp == "Fine woody debris")
pa.id = which(quad.df$spp == "Phalaris arundinacea")
hj.id = which(quad.df$spp == "Humulus japonicus")
# sum mass for each category
df.quad.sum[k, "Herbaceous biomass"] = sum(quad.df[-c(hl.id,fwd.id),"mass.g.m2"])
df.quad.sum[k, "Herbaceous litter"] =  sum(quad.df[hl.id,"mass.g.m2"])
df.quad.sum[k, "Fine woody debris"] = sum(quad.df[fwd.id,"mass.g.m2"])
if (length(pa.id) > 0) {
df.quad.sum[k, "Phalaris arundinacea"] = sum(quad.df[pa.id,"mass.g.m2"])
} else {
df.quad.sum[k, "Phalaris arundinacea"] = 0
}
if (length(hj.id) > 0) {
df.quad.sum[k, "Humulus japonicus"] = sum(quad.df[hj.id,"mass.g.m2"])
} else {
df.quad.sum[k, "Humulus japonicus"] = 0
}
df.quad.sum[k, "Mixed species"] = sum(quad.df[-c(hl.id, fwd.id, pa.id, hj.id),"mass.g.m2"])
# fill in identification columns
df.quad.sum[k, c("year","trt","trt.full","num","quad")] = c(y, t, trt.names[l], i, j)
# increment counter
k = k + 1
}
}
}
}
View(df.quad.sum)
df.quad.sum[,"Herbaceous biomass"] == df.quad.sum[,"Mixed species"] + df.quad.sum[,"Phalaris arundinacea"] + df.quad.sum[,"Humulus japonicus"]
df.quad.sum[,"Herbaceous biomass"] - (df.quad.sum[,"Mixed species"] + df.quad.sum[,"Phalaris arundinacea"] + df.quad.sum[,"Humulus japonicus"])
df.quad.sum[which(-(df.quad.sum[,"Herbaceous biomass"] == df.quad.sum[,"Mixed species"] + df.quad.sum[,"Phalaris arundinacea"] + df.quad.sum[,"Humulus japonicus"])),]
df.quad.sum[-(df.quad.sum[,"Herbaceous biomass"] == df.quad.sum[,"Mixed species"] + df.quad.sum[,"Phalaris arundinacea"] + df.quad.sum[,"Humulus japonicus"]),]
df.quad.sum[-which(df.quad.sum[,"Herbaceous biomass"] == df.quad.sum[,"Mixed species"] + df.quad.sum[,"Phalaris arundinacea"] + df.quad.sum[,"Humulus japonicus"]),]
df.quad.sum[-which((df.quad.sum[,"Herbaceous biomass"] - (df.quad.sum[,"Mixed species"] + df.quad.sum[,"Phalaris arundinacea"] + df.quad.sum[,"Humulus japonicus"])) < 0.0001,]
df.quad.sum[-which(df.quad.sum[,"Herbaceous biomass"] - (df.quad.sum[,"Mixed species"] + df.quad.sum[,"Phalaris arundinacea"] + df.quad.sum[,"Humulus japonicus"]) < 0.001),]
df.quad.sum[-which(df.quad.sum[,"Herbaceous biomass"] - (df.quad.sum[,"Mixed species"] + df.quad.sum[,"Phalaris arundinacea"] + df.quad.sum[,"Humulus japonicus"]) < 1),]
df.quad.sum[-which(df.quad.sum[,"Herbaceous biomass"] == df.quad.sum[,"Mixed species"] + df.quad.sum[,"Phalaris arundinacea"] + df.quad.sum[,"Humulus japonicus"]),]
86.55556 + 26.55556
y = 2022
t = "E"
i = 1
j = 1
# get data for given year, treatment, plot, and quadrat
quad.id = which((bm.all$year == y &bm.all$trt == t) & (bm.all$num == as.character(i) & bm.all$quad == paste("Q", j, sep="")))
quad.df = bm.all[quad.id,]
quad.df
# get HL and FWD id
hl.id = which(quad.df$spp == "Herbaceous litter")
hl.id
fwd.id = which(quad.df$spp == "Fine woody debris")
pa.id = which(quad.df$spp == "Phalaris arundinacea")
hj.id = which(quad.df$spp == "Humulus japonicus")
hwd.id
fwd.id
pa.id
hj.id
sum(quad.df[-c(hl.id,fwd.id),"mass.g.m2"])
sum(quad.df[hl.id,"mass.g.m2"])
sum(quad.df[fwd.id,"mass.g.m2"])
c(hl.id,fwd.id)
n.yr = 2; n.trt = 6; n.plt = 3; n.quad = 5
df.quad.sum = data.frame(matrix(nrow = n.yr*n.trt*n.plt*n.quad, ncol=11))
colnames(df.quad.sum) = c("year","trt","trt.full","num","quad","Herbaceous biomass","Herbaceous litter","Fine woody debris","Mixed species","Phalaris arundinacea","Humulus japonicus")
k = 1
for (y in c(2022, 2023)) {
for (l in 1:n.trt) {
t = trts[l]
for (i in 1:n.plt) {
for (j in 1:n.quad) {
# get data for given year, treatment, plot, and quadrat
quad.id = which((bm.all$year == y &bm.all$trt == t) & (bm.all$num == as.character(i) & bm.all$quad == paste("Q", j, sep="")))
quad.df = bm.all[quad.id,]
# get HL and FWD id
hl.id = which(quad.df$spp == "Herbaceous litter")
fwd.id = which(quad.df$spp == "Fine woody debris")
pa.id = which(quad.df$spp == "Phalaris arundinacea")
hj.id = which(quad.df$spp == "Humulus japonicus")
# sum mass for each category
df.quad.sum[k, "Herbaceous litter"] =  sum(quad.df[hl.id,"mass.g.m2"])
df.quad.sum[k, "Fine woody debris"] = sum(quad.df[fwd.id,"mass.g.m2"])
if (length(hl.id) > 0 | length(fwd.id) > 0) {
df.quad.sum[k, "Herbaceous biomass"] = sum(quad.df[-c(hl.id,fwd.id),"mass.g.m2"])
}
if (length(pa.id) > 0) {
df.quad.sum[k, "Phalaris arundinacea"] = sum(quad.df[pa.id,"mass.g.m2"])
} else {
df.quad.sum[k, "Phalaris arundinacea"] = 0
}
if (length(hj.id) > 0) {
df.quad.sum[k, "Humulus japonicus"] = sum(quad.df[hj.id,"mass.g.m2"])
} else {
df.quad.sum[k, "Humulus japonicus"] = 0
}
df.quad.sum[k, "Mixed species"] = sum(quad.df[-c(hl.id, fwd.id, pa.id, hj.id),"mass.g.m2"])
# fill in identification columns
df.quad.sum[k, c("year","trt","trt.full","num","quad")] = c(y, t, trt.names[l], i, j)
# increment counter
k = k + 1
}
}
}
}
df.quad.sum[-which(df.quad.sum[,"Herbaceous biomass"] == df.quad.sum[,"Mixed species"] + df.quad.sum[,"Phalaris arundinacea"] + df.quad.sum[,"Humulus japonicus"]),]
m.id = which(-(quad.df$spp %in% c("Herbaceous litter","Fine woody debris","Phalaris arundinacea","Humulus japonicus")))
# get data for given year, treatment, plot, and quadrat
quad.id = which((bm.all$year == y &bm.all$trt == t) & (bm.all$num == as.character(i) & bm.all$quad == paste("Q", j, sep="")))
quad.df = bm.all[quad.id,]
quad.df$spp %in% c("Herbaceous litter","Fine woody debris","Phalaris arundinacea","Humulus japonicus")
!(quad.df$spp %in% c("Herbaceous litter","Fine woody debris","Phalaris arundinacea","Humulus japonicus"))
quad.df
m.id = which(!(quad.df$spp %in% c("Herbaceous litter","Fine woody debris","Phalaris arundinacea","Humulus japonicus")))
quad.df[m.id,]
n.yr = 2; n.trt = 6; n.plt = 3; n.quad = 5
df.quad.sum = data.frame(matrix(nrow = n.yr*n.trt*n.plt*n.quad, ncol=11))
colnames(df.quad.sum) = c("year","trt","trt.full","num","quad","Herbaceous biomass","Herbaceous litter","Fine woody debris","Mixed species","Phalaris arundinacea","Humulus japonicus")
k = 1
for (y in c(2022, 2023)) {
for (l in 1:n.trt) {
t = trts[l]
for (i in 1:n.plt) {
for (j in 1:n.quad) {
# get data for given year, treatment, plot, and quadrat
quad.id = which((bm.all$year == y &bm.all$trt == t) & (bm.all$num == as.character(i) & bm.all$quad == paste("Q", j, sep="")))
quad.df = bm.all[quad.id,]
# get HL and FWD id
hl.id = which(quad.df$spp == "Herbaceous litter")
fwd.id = which(quad.df$spp == "Fine woody debris")
pa.id = which(quad.df$spp == "Phalaris arundinacea")
hj.id = which(quad.df$spp == "Humulus japonicus")
m.id = which(!(quad.df$spp %in% c("Herbaceous litter","Fine woody debris","Phalaris arundinacea","Humulus japonicus")))
# sum mass for each category
df.quad.sum[k, "Herbaceous litter"] =  sum(quad.df[hl.id, "mass.g.m2"])
df.quad.sum[k, "Fine woody debris"] = sum(quad.df[fwd.id, "mass.g.m2"])
df.quad.sum[k, "Herbaceous biomass"] = sum(quad.df[m.id, "mass.g.m2"])
if (length(pa.id) > 0) {
df.quad.sum[k, "Phalaris arundinacea"] = sum(quad.df[pa.id, "mass.g.m2"])
} else {
df.quad.sum[k, "Phalaris arundinacea"] = 0
}
if (length(hj.id) > 0) {
df.quad.sum[k, "Humulus japonicus"] = sum(quad.df[hj.id, "mass.g.m2"])
} else {
df.quad.sum[k, "Humulus japonicus"] = 0
}
if (length(m.id) > 0) {
df.quad.sum[k, "Mixed species"] = sum(quad.df[m.id, "mass.g.m2"])
} else {
df.quad.sum[k, "Mixed species"] = 0
}
# fill in identification columns
df.quad.sum[k, c("year","trt","trt.full","num","quad")] = c(y, t, trt.names[l], i, j)
# increment counter
k = k + 1
}
}
}
}
View(df.quad.sum)
n.yr = 2; n.trt = 6; n.plt = 3; n.quad = 5
df.quad.sum = data.frame(matrix(nrow = n.yr*n.trt*n.plt*n.quad, ncol=11))
colnames(df.quad.sum) = c("year","trt","trt.full","num","quad","Herbaceous biomass","Herbaceous litter","Fine woody debris","Mixed species","Phalaris arundinacea","Humulus japonicus")
k = 1
for (y in c(2022, 2023)) {
for (l in 1:n.trt) {
t = trts[l]
for (i in 1:n.plt) {
for (j in 1:n.quad) {
# get data for given year, treatment, plot, and quadrat
quad.id = which((bm.all$year == y &bm.all$trt == t) & (bm.all$num == as.character(i) & bm.all$quad == paste("Q", j, sep="")))
quad.df = bm.all[quad.id,]
# get HL and FWD id
hl.id = which(quad.df$spp == "Herbaceous litter")
fwd.id = which(quad.df$spp == "Fine woody debris")
pa.id = which(quad.df$spp == "Phalaris arundinacea")
hj.id = which(quad.df$spp == "Humulus japonicus")
bm.id = which(!(quad.df$spp %in% c("Herbaceous litter","Fine woody debris")))
m.id = which(!(quad.df$spp %in% c("Herbaceous litter","Fine woody debris","Phalaris arundinacea","Humulus japonicus")))
# sum mass for each category
df.quad.sum[k, "Herbaceous litter"] =  sum(quad.df[hl.id, "mass.g.m2"])
df.quad.sum[k, "Fine woody debris"] = sum(quad.df[fwd.id, "mass.g.m2"])
df.quad.sum[k, "Herbaceous biomass"] = sum(quad.df[bm.id, "mass.g.m2"])
if (length(pa.id) > 0) {
df.quad.sum[k, "Phalaris arundinacea"] = sum(quad.df[pa.id, "mass.g.m2"])
} else {
df.quad.sum[k, "Phalaris arundinacea"] = 0
}
if (length(hj.id) > 0) {
df.quad.sum[k, "Humulus japonicus"] = sum(quad.df[hj.id, "mass.g.m2"])
} else {
df.quad.sum[k, "Humulus japonicus"] = 0
}
if (length(m.id) > 0) {
df.quad.sum[k, "Mixed species"] = sum(quad.df[m.id, "mass.g.m2"])
} else {
df.quad.sum[k, "Mixed species"] = 0
}
# fill in identification columns
df.quad.sum[k, c("year","trt","trt.full","num","quad")] = c(y, t, trt.names[l], i, j)
# increment counter
k = k + 1
}
}
}
}
df.quad.sum[-which(df.quad.sum[,"Herbaceous biomass"] == df.quad.sum[,"Mixed species"] + df.quad.sum[,"Phalaris arundinacea"] + df.quad.sum[,"Humulus japonicus"]),]
# melt biomass dataframe
df.melt = melt(df.quad.sum, id.vars = c("year","trt","trt.full","num","quad"), variable.name = "type", value.name="mass.g.m2")
ggplot(df.melt[which(df.melt$type %in% c("Herbaceous biomass","Herbaceous litter","Fine woody debris"))], aes(y=factor(trt.full, levels=trt.names), x=mass.g.m2, fill=factor(year))) +
geom_boxplot() + labs(y="Treatment", x="Total mass (g/m2)", fill="") +
theme(legend.title = element_blank(),legend.text = element_text(size=14),
axis.title = element_text(size=16), axis.text = element_text(size=12)) +
facet_wrap(.~type, scales="free_x")
View(df.melt)
ggplot(df.melt[which(df.melt$type %in% c("Herbaceous biomass","Herbaceous litter","Fine woody debris")),], aes(y=factor(trt.full, levels=trt.names), x=mass.g.m2, fill=factor(year))) +
geom_boxplot() + labs(y="Treatment", x="Total mass (g/m2)", fill="") +
theme(legend.title = element_blank(),legend.text = element_text(size=14),
axis.title = element_text(size=16), axis.text = element_text(size=12)) +
facet_wrap(.~type, scales="free_x")
ggplot(df.melt[which(df.melt$type %in% c("Mixed species","Phalaris arundinacea","Humulus japonicus")),], aes(y=factor(trt.full, levels=trt.names), x=mass.g.m2, fill=factor(year))) +
geom_boxplot() + labs(y="Treatment", x="Total mass (g/m2)", fill="") +
theme(legend.title = element_blank(),legend.text = element_text(size=14),
axis.title = element_text(size=16), axis.text = element_text(size=12)) +
facet_wrap(.~type, scales="free_x")
ggplot(df.melt[which(df.melt$type %in% c("Mixed species","Phalaris arundinacea","Humulus japonicus")),], aes(y=factor(trt.full, levels=trt.names), x=mass.g.m2, fill=factor(type))) +
geom_boxplot() + labs(y="Treatment", x="Total mass (g/m2)", fill="") +
theme(legend.title = element_blank(),legend.text = element_text(size=14),
axis.title = element_text(size=16), axis.text = element_text(size=12)) +
facet_wrap(.~year, scales="free_x")
ggplot(df.melt[which(df.melt$type %in% c("Mixed species","Phalaris arundinacea","Humulus japonicus")),], aes(y=factor(trt.full, levels=trt.names), x=mass.g.m2, fill=factor(type))) +
geom_violin() + labs(y="Treatment", x="Total mass (g/m2)", fill="") +
theme(legend.title = element_blank(),legend.text = element_text(size=14),
axis.title = element_text(size=16), axis.text = element_text(size=12)) +
facet_wrap(.~year, scales="free_x")
ggplot(df.melt[which(df.melt$type %in% c("Mixed species","Phalaris arundinacea","Humulus japonicus")),], aes(y=factor(trt.full, levels=trt.names), x=mass.g.m2, fill=factor(type))) +
geom_boxplot() + labs(y="Treatment", x="Total mass (g/m2)", fill="") +
theme(legend.title = element_blank(),legend.text = element_text(size=14),
axis.title = element_text(size=16), axis.text = element_text(size=12)) +
facet_wrap(.~year, scales="free_x")
# isolate biomass data
bm.dat = bm.all[!(bm.all$spp == "Herbaceous litter" | bm.all$spp == "Fine woody debris"),]
View(bm.dat)
View(bm.dat)
bm.sp.sum = bm.dat %>% group_by(plot, trt, spp) %>% summarise(mean.ass = sum(mass)/3)
bm.sp.sum = bm.dat %>% group_by(plot, trt, spp) %>% summarise(mean.mass = sum(mass.g.m2)/3)
View(bm.sp.sum)
ggplot(bm.sp.sum, aes(x=trt, y=mean.mass, fill=spp)) +
geom_bar(position="stack", stat="identity") +
labs(x="Treatment", y="Herbaceous biomass (g/m2)", fill="Species") +
facet_wrap(.~year)
bm.sp.sum = bm.dat %>% group_by(year,plot, trt, spp) %>% summarise(mean.mass = sum(mass.g.m2)/3)
ggplot(bm.sp.sum, aes(x=trt, y=mean.mass, fill=spp)) +
geom_bar(position="stack", stat="identity") +
labs(x="Treatment", y="Herbaceous biomass (g/m2)", fill="Species") +
facet_wrap(.~year)
bm.dat$trt.full = rep(0, nrow(bm.dat))
for (i in 1:6) {bm.dat$trt.full[which(bm.dat$trt == trts[i])] = trt.names[i]}
View(bm.dat)
ggplot(bm.sp.sum, aes(x=factor(trt.full, levels=trt.names), y=mean.mass, fill=spp)) +
geom_bar(position="stack", stat="identity") +
labs(x="Treatment", y="Herbaceous biomass (g/m2)", fill="Species") +
facet_wrap(.~year)
bm.dat = bm.all[!(bm.all$spp == "Herbaceous litter" | bm.all$spp == "Fine woody debris"),]
bm.dat$trt.full = rep(0, nrow(bm.dat))
for (i in 1:6) {bm.dat$trt.full[which(bm.dat$trt == trts[i])] = trt.names[i]}
bm.sp.sum = bm.dat %>% group_by(year, plot, trt, trt.full, spp) %>% summarise(mean.mass = sum(mass.g.m2)/3)
ggplot(bm.sp.sum, aes(x=factor(trt.full, levels=trt.names), y=mean.mass, fill=spp)) +
geom_bar(position="stack", stat="identity") +
labs(x="Treatment", y="Herbaceous biomass (g/m2)", fill="Species") +
facet_wrap(.~year)
ggplot(bm.sp.sum, aes(x=factor(trt.full, levels=trt.names), y=mean.mass, fill=spp, group=year)) +
geom_bar(position="stack", stat="identity") +
labs(x="Treatment", y="Herbaceous biomass (g/m2)", fill="Species")
ggplot(bm.sp.sum, aes(x=factor(trt.full, levels=trt.names), y=mean.mass, fill=spp, group=year)) +
geom_bar(position=position_dodge(width=0.5), stat="identity") +
labs(x="Treatment", y="Herbaceous biomass (g/m2)", fill="Species")
ggplot(bm.sp.sum, aes(x=factor(trt.full, levels=trt.names), y=mean.mass, fill=spp, group=year)) +
geom_bar(position=position_dodge(width=1), stat="identity") +
labs(x="Treatment", y="Herbaceous biomass (g/m2)", fill="Species")
ggplot(bm.sp.sum, aes(x=factor(trt.full, levels=trt.names), y=mean.mass, fill=spp, color=spp, group=year)) +
geom_bar(position=position_dodge(width=1), stat="identity") +
labs(x="Treatment", y="Herbaceous biomass (g/m2)", fill="Species")
ggplot(bm.sp.sum, aes(x=factor(trt.full, levels=trt.names), y=mean.mass, fill=spp)) +
geom_bar(position=position_dodge(width=1), stat="identity") +
labs(x="Treatment", y="Herbaceous biomass (g/m2)", fill="Species") +
facet_wrap(.~year)
ggplot(bm.sp.sum, aes(x=factor(trt.full, levels=trt.names), y=mean.mass, fill=spp)) +
geom_bar(position="stack", stat="identity") +
labs(x="Treatment", y="Herbaceous biomass (g/m2)", fill="Species") +
facet_wrap(.~year)
ggplot(bm.sp.sum, aes(y=factor(trt.full, levels=trt.names), x=mean.mass, fill=spp)) +
geom_bar(position="stack", stat="identity") +
labs(y="Treatment", x="Herbaceous biomass (g/m2)", fill="Species") +
facet_wrap(.~year)
knitr::opts_chunk$set(echo=T, message=F)
library(rethinking)
# prepare data
data(rugged)
d <- rugged
d$log_gdp <- log(d$rgdppc_2000)
dd <- d[ complete.cases(d$rgdppc_2000) , ]
dd$log_gdp_std <- dd$log_gdp / mean(dd$log_gdp)
dd$rugged_std <- dd$rugged / max(dd$rugged)
dd$cid <- ifelse( dd$cont_africa==1 , 1 , 2 )
# isolate essential data
dat_slim <- list(log_gdp_std = dd$log_gdp_std,
rugged_std = dd$rugged_std,
cid = as.integer( dd$cid ))
# fit model with exponential prior (rate = 1)
m9.1.exp <- ulam(alist(log_gdp_std ~ dnorm( mu , sigma ),
mu <- a[cid] + b[cid]*( rugged_std - 0.215 ) ,
a[cid] ~ dnorm( 1 , 0.1 ) ,
b[cid] ~ dnorm( 0 , 0.3 ) ,
sigma ~ dexp( 1 )) ,
data=dat_slim , chains=1 )
# fit model with uniform prior
m9.1.uni <- ulam(alist(log_gdp_std ~ dnorm( mu , sigma ),
mu <- a[cid] + b[cid]*( rugged_std - 0.215 ) ,
a[cid] ~ dnorm( 1 , 0.1 ) ,
b[cid] ~ dnorm( 0 , 0.3 ) ,
sigma ~ dunif(0, 1)) ,
data=dat_slim , chains=1 )
# fit model with exponential posterior (rate = 0.3)
m9.1.exp2 <- ulam(alist(log_gdp_std ~ dnorm( mu , sigma ),
mu <- a[cid] + b[cid]*( rugged_std - 0.215 ) ,
a[cid] ~ dnorm( 1 , 0.1 ) ,
b[cid] ~ dnorm( 0 , 0.3 ) ,
sigma ~ dexp( 0.3 )) ,
data=dat_slim , chains=1 )
# look at distributions
post.exp = extract.samples(m9.1.exp)
post.exp2 = extract.samples(m9.1.exp2)
dens(post.exp)
dens(post.exp$sigma)
dens(post.exp$sigma)
dens(post.exp2$sigma, col="blue")
plot(type="n")
dens(post.exp$sigma)
plot(x=c(0,0.2),y=c(50,50),type="n")
dens(post.exp$sigma)
dens(post.exp2$sigma, col="blue")
## compare posterior distributions between the two exponential models
# look at tables
precis(m9.1.exp, depth=2)
precis(m9.1.exp2, depth=2)
# look at plots
pairs(m9.1.exp)
pairs(m9.1.exp2)
# look at chains
traceplot(m9.1.exp)
traceplot(m9.1.exp2)
# look at distributions
post.exp = extract.samples(m9.1.exp)
post.exp2 = extract.samples(m9.1.exp2)
dens(post.exp$sigma)
dens(post.exp2$sigma, col="blue")
post = extract.samples(mDA.u)
?standardize
?scale
data(WaffleDivorce)
d <- WaffleDivorce
# standardize variables
d$D <- standardize( d$Divorce )
d$M <- standardize( d$Marriage )
d$A <- standardize( d$MedianAgeMarriage )
# slim dataframe
ds = list(D = d$D, M = d$M, A = d$A)
ds
# load data
data(WaffleDivorce)
d <- WaffleDivorce
# standardize variables
d$D <- scale( d$Divorce )
d$M <- standardize( d$Marriage )
d$A <- standardize( d$MedianAgeMarriage )
# slim dataframe
ds = list(D = d$D, M = d$M, A = d$A)
# fit models with quap
mDA.q <- quap(alist(D ~ dnorm(mu, sigma),
mu <- a + bA*A,
a ~ dnorm(0, 0.2),
bA ~ dnorm(0, 0.5),
sigma ~ dexp(1)),
data=ds)
mDM.q <- quap(alist(D~dnorm(mu, sigma),
mu <- a + bM*M,
a ~ dnorm(0, 0.2),
bM ~ dnorm(0, 0.5),
sigma ~ dexp(1)),
data=ds)
mDMA.q = quap(alist(D ~ dnorm(mu, sigma),
mu <- a + bM*M + bA*A,
a ~ dnorm(0,0.2),
bM ~ dnorm(0,0.5),
bA ~ dnorm(0,0.5),
sigma ~ dexp(1)),
data = ds)
# fit models with ulam
mDA.u <- ulam(alist(D ~ dnorm(mu, sigma),
mu <- a + bA*A,
a ~ dnorm(0, 0.2),
bA ~ dnorm(0, 0.5),
sigma ~ dexp(1)),
data=ds, log_lik = TRUE)
mDM.u <- ulam(alist(D~dnorm(mu, sigma),
mu <- a + bM*M,
a ~ dnorm(0, 0.2),
bM ~ dnorm(0, 0.5),
sigma ~ dexp(1)),
data=ds, log_lik = TRUE)
mDMA.u = ulam(alist(D ~ dnorm(mu, sigma),
mu <- a + bM*M + bA*A,
a ~ dnorm(0,0.2),
bM ~ dnorm(0,0.5),
bA ~ dnorm(0,0.5),
sigma ~ dexp(1)),
data = ds, log_lik = TRUE)
data(WaffleDivorce)
d <- WaffleDivorce
# standardize variables
d$D <- scale( d$Divorce )
d$M <- scale( d$Marriage )
d$A <- scale( d$MedianAgeMarriage )
# slim dataframe
ds = list(D = d$D, M = d$M, A = d$A)
# fit models with quap
mDA.q <- quap(alist(D ~ dnorm(mu, sigma),
mu <- a + bA*A,
a ~ dnorm(0, 0.2),
bA ~ dnorm(0, 0.5),
sigma ~ dexp(1)),
data=ds)
